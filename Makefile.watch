# ============================================================
# Makefile.watch
# ------------------------------------------------------------
# Real-time Kubernetes observability helpers.
#
# This file provides lightweight monitoring dashboards using
# only standard CLI tools (kubectl, watch, awk, tput).
# It is intended to complement the main Makefile by offering
# quick insights into the cluster state without needing
# complex UIs or installations.
# ============================================================

.DEFAULT_GOAL := help

# ------------------------------------------------------------
# help
# ------------------------------------------------------------
# Displays available targets and usage instructions
# ------------------------------------------------------------
.PHONY: help
help:
	@echo ""
	@echo "ğŸ” Makefile.watch â€” Kubernetes Monitoring Helpers"
	@echo ""
	@echo "Available targets:"
	@echo ""
	@echo "  make -f Makefile.watch watch-classified    ğŸ“¦ Simple dashboard grouped by pod status"
	@echo "  make -f Makefile.watch watch-dashboard-pro ğŸš€ Advanced dashboard (progress bars, trends)"
	@echo ""
	@echo "Tips:"
	@echo "  - Press Ctrl+C to stop any watcher"
	@echo "  - Requires: kubectl, watch, awk, tput"
	@echo ""


# ------------------------------------------------------------
# watch-classified
# ------------------------------------------------------------
.PHONY: watch-classified
watch-classified:
	@echo "ğŸ“Š Fancy dashboard: Pods grouped by STATUS (auto-refresh every 2s)"
	@echo ""
	@watch -t -n 2 '\
	echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"; \
	echo "ğŸ“¦ Kubernetes Pods Dashboard â€” $$(date)"; \
	echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"; \
	echo ""; \
	echo "ğŸŸ¢ RUNNING"; \
	kubectl get pods -A --no-headers | awk '\''$$4=="Running"{print "  " $$1 "/" $$2 " (" $$4 ")"}'\'' || true; \
	echo ""; \
	echo "ğŸŸ¡ PENDING / CONTAINER CREATING"; \
	kubectl get pods -A --no-headers | awk '\''$$4=="Pending" || $$4=="ContainerCreating"{print "  " $$1 "/" $$2 " (" $$4 ")"}'\'' || true; \
	echo ""; \
	echo "ğŸ”´ CRASHLOOP / ERROR / FAILED"; \
	kubectl get pods -A --no-headers | awk '\''$$4 ~ /CrashLoop|Error|Failed/{print "  " $$1 "/" $$2 " (" $$4 ")"}'\'' || true; \
	echo ""; \
	echo "ğŸ”µ COMPLETED"; \
	kubectl get pods -A --no-headers | awk '\''$$4=="Completed"{print "  " $$1 "/" $$2 " (" $$4 ")"}'\'' || true; \
	echo ""; \
	echo "âšª OTHER STATES"; \
	kubectl get pods -A --no-headers | awk '\''$$4!="Running" && $$4!="Pending" && $$4!="Completed" && $$4!="ContainerCreating" && $$4 !~ /CrashLoop|Error|Failed/{print "  " $$1 "/" $$2 " (" $$4 ")"}'\'' || true; \
	echo ""; \
	echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"'

# ------------------------------------------------------------
# watch-dashboard-pro
# ------------------------------------------------------------
.PHONY: watch-dashboard-pro
watch-dashboard-pro:
	@echo "ğŸš€ Launching PRO Kubernetes Dashboard (colors + namespace grouping)..."
	@echo ""
	@watch -n 2 -t bash scripts/kube-dashboard-pro.sh
# End of Makefile.watch